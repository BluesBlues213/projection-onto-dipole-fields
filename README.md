# Input & Output
function [NPhase, J, R]=pdf_method(data,mask,N) ... outputs corrected phase image (NPhase), the estimated/removed background field (J), and L2 norm residuals (R) from the Conjugate Gradient on Normal Equations method or CNGE used ... inputs of raw phase data with artifact (data), mask of the image (mask) and number of iterations (N) for CGNE. 

# Result
Example image shows the raw phase data, corrected phase result, the field that was removed, and the conjugate gradient convergence pattern with N=20. The data and mask files used in the example are in the file example_data. 

# Motivation

This script was developed as part of my PhD project to remove large spatially varying background field artifacts in 2D gradient echo (GRE) phase images. The minimization formulated in Equation 4 of the cited paper is solved using a Conjugate Gradient on Normal Equations or CGNE method.  

# Theory

This technique is first described in Liu et al. 2011. A novel background field removal method for MRI using projection onto dipole fields (PDF). NMR Biomedicine.

"For optimal image quality in susceptibility-weighted imaging and accurate quantification of susceptibility, it is necessary to isolate the local field generated by local magnetic sources (such as iron) from the background field that arises from imperfect shimming and variations in magnetic susceptibility of surrounding tissues (including air). A nonparametric background field removal technique based on projection onto dipole fields (PDF). In this PDF technique, the background field inside an ROI is decomposed into a field originating from dipoles outside the ROI using the projection theorem in Hilbert space. This novel PDF background removal technique was validated on a numerical simulation and a phantom experiment and was applied in human brain imaging, demonstrating substantial improvement in background field removal compared with the commonly used high-pass filtering method."
